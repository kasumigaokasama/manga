{"ast":null,"code":"import _asyncToGenerator from \"C:/manga/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { signal } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/api.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nfunction AdminPage_tr_33_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\")(6, \"select\", 17);\n    i0.ɵɵlistener(\"ngModelChange\", function AdminPage_tr_33_Template_select_ngModelChange_6_listener($event) {\n      const u_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.updateRole(u_r2, $event));\n    });\n    i0.ɵɵelementStart(7, \"option\", 7);\n    i0.ɵɵtext(8, \"reader\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"option\", 8);\n    i0.ɵɵtext(10, \"editor\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"option\", 9);\n    i0.ɵɵtext(12, \"admin\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(13, \"td\");\n    i0.ɵɵtext(14);\n    i0.ɵɵpipe(15, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"td\")(17, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function AdminPage_tr_33_Template_button_click_17_listener() {\n      const u_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.setPassword(u_r2));\n    });\n    i0.ɵɵtext(18, \"Passwort\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"button\", 19);\n    i0.ɵɵlistener(\"click\", function AdminPage_tr_33_Template_button_click_19_listener() {\n      const u_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.remove(u_r2));\n    });\n    i0.ɵɵtext(20, \"Loeschen\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const u_r2 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(u_r2.id);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(u_r2.email);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngModel\", u_r2.role);\n    i0.ɵɵadvance(8);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(15, 4, u_r2.createdAt, \"short\"));\n  }\n}\nexport let AdminPage = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class AdminPage {\n    constructor(api) {\n      this.api = api;\n      this.users = signal([], ...(ngDevMode ? [{\n        debugName: \"users\"\n      }] : []));\n      this.audit = signal([], ...(ngDevMode ? [{\n        debugName: \"audit\"\n      }] : []));\n      this.email = '';\n      this.password = '';\n      this.role = 'reader';\n    }\n    ngOnInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        yield _this.load();\n        yield _this.loadAudit();\n        _this.auditTimer = setInterval(() => _this.loadAudit(), 5000);\n      })();\n    }\n    ngOnDestroy() {\n      if (this.auditTimer) clearInterval(this.auditTimer);\n    }\n    load() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          _this2.users.set(yield _this2.api.adminListUsers());\n        } catch {\n          alert('Nicht berechtigt');\n        }\n      })();\n    }\n    loadAudit() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          _this3.audit.set(yield _this3.api.adminListAudit());\n        } catch {\n          _this3.audit.set([]);\n        }\n      })();\n    }\n    create() {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          yield _this4.api.adminCreateUser(_this4.email, _this4.password, _this4.role);\n          _this4.email = '';\n          _this4.password = '';\n          _this4.role = 'reader';\n          yield _this4.load();\n        } catch {\n          alert('Erstellen fehlgeschlagen');\n        }\n      })();\n    }\n    updateRole(u, role) {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          yield fetch(`${_this5.api.base}/api/users/${u.id}`, {\n            method: 'PATCH',\n            headers: {\n              'Content-Type': 'application/json',\n              'Authorization': `Bearer ${_this5.api.token()}`\n            },\n            body: JSON.stringify({\n              role\n            })\n          });\n          yield _this5.load();\n        } catch {\n          alert('Update fehlgeschlagen');\n        }\n      })();\n    }\n    remove(u) {\n      var _this6 = this;\n      return _asyncToGenerator(function* () {\n        if (!confirm(`Benutzer ${u.email} loeschen?`)) return;\n        try {\n          yield fetch(`${_this6.api.base}/api/users/${u.id}`, {\n            method: 'DELETE',\n            headers: {\n              'Authorization': `Bearer ${_this6.api.token()}`\n            }\n          });\n          yield _this6.load();\n        } catch {\n          alert('Loeschen fehlgeschlagen');\n        }\n      })();\n    }\n    setPassword(u) {\n      var _this7 = this;\n      return _asyncToGenerator(function* () {\n        const p = prompt(`Neues Passwort für ${u.email}:`);\n        if (!p) return;\n        try {\n          yield _this7.api.adminSetPassword(u.id, p);\n          alert('Passwort gesetzt');\n        } catch {\n          alert('Fehlgeschlagen');\n        }\n      })();\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function AdminPage_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || AdminPage)(i0.ɵɵdirectiveInject(i1.ApiService));\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AdminPage,\n      selectors: [[\"app-admin\"]],\n      decls: 42,\n      vars: 7,\n      consts: [[1, \"max-w-3xl\", \"mx-auto\", \"grid\", \"gap-4\"], [1, \"card\"], [1, \"font-bold\", \"mb-2\"], [1, \"grid\", \"gap-2\", \"md:grid-cols-4\", 3, \"ngSubmit\"], [\"placeholder\", \"E-Mail\", \"name\", \"email\", \"required\", \"\", 1, \"border\", \"p-2\", \"rounded\", 3, \"ngModelChange\", \"ngModel\"], [\"placeholder\", \"Passwort\", \"type\", \"password\", \"name\", \"password\", \"required\", \"\", 1, \"border\", \"p-2\", \"rounded\", 3, \"ngModelChange\", \"ngModel\"], [\"name\", \"role\", 1, \"border\", \"p-2\", \"rounded\", 3, \"ngModelChange\", \"ngModel\"], [\"value\", \"reader\"], [\"value\", \"editor\"], [\"value\", \"admin\"], [1, \"bg-matcha\", \"text-white\", \"rounded\", \"px-4\"], [1, \"overflow-x-auto\"], [1, \"w-full\", \"text-sm\"], [1, \"text-left\"], [4, \"ngFor\", \"ngForOf\"], [1, \"bg-gray-200\", \"rounded\", \"px-3\", \"py-1\", \"mb-2\", 3, \"click\"], [1, \"text-xs\", \"bg-gray-50\", \"p-2\", \"rounded\", \"overflow-x-auto\", \"max-h-64\"], [1, \"border\", \"p-1\", \"rounded\", 3, \"ngModelChange\", \"ngModel\"], [1, \"bg-gray-200\", \"rounded\", \"px-3\", \"py-1\", \"mr-2\", 3, \"click\"], [1, \"bg-kurenai\", \"text-white\", \"rounded\", \"px-3\", \"py-1\", 3, \"click\"]],\n      template: function AdminPage_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h2\", 2);\n          i0.ɵɵtext(3, \"Benutzer anlegen\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(4, \"form\", 3);\n          i0.ɵɵlistener(\"ngSubmit\", function AdminPage_Template_form_ngSubmit_4_listener() {\n            return ctx.create();\n          });\n          i0.ɵɵelementStart(5, \"input\", 4);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function AdminPage_Template_input_ngModelChange_5_listener($event) {\n            i0.ɵɵtwoWayBindingSet(ctx.email, $event) || (ctx.email = $event);\n            return $event;\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(6, \"input\", 5);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function AdminPage_Template_input_ngModelChange_6_listener($event) {\n            i0.ɵɵtwoWayBindingSet(ctx.password, $event) || (ctx.password = $event);\n            return $event;\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(7, \"select\", 6);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function AdminPage_Template_select_ngModelChange_7_listener($event) {\n            i0.ɵɵtwoWayBindingSet(ctx.role, $event) || (ctx.role = $event);\n            return $event;\n          });\n          i0.ɵɵelementStart(8, \"option\", 7);\n          i0.ɵɵtext(9, \"reader\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(10, \"option\", 8);\n          i0.ɵɵtext(11, \"editor\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(12, \"option\", 9);\n          i0.ɵɵtext(13, \"admin\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(14, \"button\", 10);\n          i0.ɵɵtext(15, \"Anlegen\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(16, \"div\", 1)(17, \"h2\", 2);\n          i0.ɵɵtext(18, \"Benutzer\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(19, \"div\", 11)(20, \"table\", 12)(21, \"thead\")(22, \"tr\")(23, \"th\", 13);\n          i0.ɵɵtext(24, \"ID\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(25, \"th\", 13);\n          i0.ɵɵtext(26, \"E-Mail\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(27, \"th\", 13);\n          i0.ɵɵtext(28, \"Rolle\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(29, \"th\", 13);\n          i0.ɵɵtext(30, \"Erstellt\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(31, \"th\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(32, \"tbody\");\n          i0.ɵɵtemplate(33, AdminPage_tr_33_Template, 21, 7, \"tr\", 14);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(34, \"div\", 1)(35, \"h2\", 2);\n          i0.ɵɵtext(36, \"Audit (neueste Ereignisse)\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(37, \"button\", 15);\n          i0.ɵɵlistener(\"click\", function AdminPage_Template_button_click_37_listener() {\n            return ctx.loadAudit();\n          });\n          i0.ɵɵtext(38, \"Aktualisieren\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(39, \"pre\", 16);\n          i0.ɵɵtext(40);\n          i0.ɵɵpipe(41, \"json\");\n          i0.ɵɵelementEnd()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(5);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.email);\n          i0.ɵɵadvance();\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.password);\n          i0.ɵɵadvance();\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.role);\n          i0.ɵɵadvance(26);\n          i0.ɵɵproperty(\"ngForOf\", ctx.users());\n          i0.ɵɵadvance(7);\n          i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(41, 5, ctx.audit()));\n        }\n      },\n      dependencies: [CommonModule, i2.NgForOf, FormsModule, i3.ɵNgNoValidate, i3.NgSelectOption, i3.ɵNgSelectMultipleOption, i3.DefaultValueAccessor, i3.SelectControlValueAccessor, i3.NgControlStatus, i3.NgControlStatusGroup, i3.RequiredValidator, i3.NgModel, i3.NgForm, i2.JsonPipe, i2.DatePipe],\n      encapsulation: 2\n    }));\n  }\n  _staticBlock();\n  return AdminPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}